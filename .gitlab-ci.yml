stages:
  - merge-master>homolog 
  - merge-homolog>homolog-qa
  - merge-homolog>dev

Merge-Master > Homolog:
  image: bitnami/git:2.42.1 
  stage: merge-master>homolog
  tags:
    - merge

  script: 
    - export CI_JOB_TOKEN="akKJsReWXCEj8n31Yxg2"
    - git config --global user.email "desenvolvimento@sifat.com.br"
    - git config --global user.name "gitlab auto-merge"
    - git config pull.rebase true
    - git status
    - git fetch
    - git checkout homolog # Checkout na branch que irá receber o merge
    - git checkout .
    - git rebase --abort
    - git checkout .
    - git pull --allow-unrelated-histories
    - echo $CI_COMMIT_REF_NAME
    - git fetch --unshallow
    - git remote set-branches origin '*'
    - git fetch --depth=1000000    
    - git merge origin/$CI_COMMIT_REF_NAME --allow-unrelated-histories # Nao remover ORIGIN
    - git push --force "http://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.sifat.com.br:8888/waybe-microsservicos/api-teste-devops.git"

  only:
    - master 

Merge-Homolog > Dev:
  image: bitnami/git:2.42.1
  stage: merge-homolog>dev
  tags:
    - merge

  script: 
    - export CI_JOB_TOKEN="akKJsReWXCEj8n31Yxg2"
    - git config --global user.email "desenvolvimento@sifat.com.br"
    - git config --global user.name "gitlab auto-merge"
    - git config pull.rebase true
    - git status
    - git fetch
    - git checkout dev # Checkout na branch que irá receber o merge
    - git pull --allow-unrelated-histories
    - echo $CI_COMMIT_REF_NAME
    - git fetch --unshallow
    - git remote set-branches origin '*'
    - git fetch --depth=1000000    
    - git merge origin/$CI_COMMIT_REF_NAME --allow-unrelated-histories # Nao remover ORIGIN
    - git push --force "http://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.sifat.com.br:8888/waybe-microsservicos/api-teste-devops.git"

  only:
    - homolog   
    
Merge-Homolog > Homolog-qa:
  image: bitnami/git:2.42.1
  stage: merge-homolog>homolog-qa
  tags:
    - merge

  script: 
    - export CI_JOB_TOKEN="akKJsReWXCEj8n31Yxg2"
    - git config --global user.email "desenvolvimento@sifat.com.br"
    - git config --global user.name "gitlab auto-merge"
    - git config pull.rebase true
    - git status
    - git fetch
    - git checkout homolog-qa # Checkout na branch que irá receber o merge
    - git pull --allow-unrelated-histories
    - echo $CI_COMMIT_REF_NAME
    - git merge origin/$CI_COMMIT_REF_NAME --allow-unrelated-histories
    - git fetch --unshallow
    - git remote set-branches origin '*'
    - git fetch --depth=1000000
    - git push --force "http://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.sifat.com.br:8888/waybe-microsservicos/api-teste-devops.git"

  only:
    - homolog